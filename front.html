<html lang="es" class="h-full">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Infinite Axis — Eliminador de Fondos</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* Estilos personalizados para los sliders */
  .slider {
    -webkit-appearance: none;
    appearance: none;
    background: #404040;
    outline: none;
  }
  
  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    background: #8b5cf6;
    cursor: pointer;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  .slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    background: #8b5cf6;
    cursor: pointer;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  .slider:hover::-webkit-slider-thumb {
    background: #7c3aed;
  }
  
  .slider:hover::-moz-range-thumb {
    background: #7c3aed;
  }

  /* Modo Claro - Overrides */
  [data-theme="light"] .sidebar-bg {
    background-color: #f5f5f5 !important;
    border-color: #e5e5e5 !important;
  }

  [data-theme="light"] .card-bg {
    background-color: #ffffff !important;
    border-color: #e5e5e5 !important;
  }

  [data-theme="light"] .neutral-card {
    background-color: #f9fafb !important;
    border-color: #e5e7eb !important;
  }

  [data-theme="light"] .upload-area {
    background-color: #f9fafb !important;
    border-color: #d1d5db !important;
  }

  [data-theme="light"] .upload-area:hover {
    background-color: #f3f4f6 !important;
    border-color: #9ca3af !important;
  }

  [data-theme="light"] .text-neutral-100 {
    color: #171717 !important;
  }

  [data-theme="light"] .text-neutral-300 {
    color: #404040 !important;
  }

  [data-theme="light"] .text-neutral-400 {
    color: #737373 !important;
  }

  [data-theme="light"] .text-neutral-500 {
    color: #a3a3a3 !important;
  }

  [data-theme="light"] .text-neutral-600 {
    color: #525252 !important;
  }

  [data-theme="light"] .bg-neutral-800 {
    background-color: #f3f4f6 !important;
  }

  [data-theme="light"] .bg-neutral-800:hover {
    background-color: #e5e7eb !important;
  }

  [data-theme="light"] .bg-neutral-800\/50 {
    background-color: rgba(243, 244, 246, 0.8) !important;
  }

  [data-theme="light"] .bg-neutral-900\/50 {
    background-color: #ffffff !important;
  }

  [data-theme="light"] .bg-neutral-900\/30 {
    background-color: rgba(255, 255, 255, 0.8) !important;
  }

  [data-theme="light"] .border-neutral-800 {
    border-color: #e5e5e5 !important;
  }

  [data-theme="light"] .border-neutral-700 {
    border-color: #d4d4d4 !important;
  }

  [data-theme="light"] footer {
    background-color: rgba(255, 255, 255, 0.9) !important;
  }
</style>
</head>
<body class="min-h-full antialiased bg-neutral-950 text-neutral-100 transition-colors duration-200" style="font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;" data-theme="dark">

<div class="flex h-screen overflow-hidden">
  <!-- Sidebar -->
  <aside class="sidebar-bg w-80 border-r border-neutral-800 bg-neutral-900/50 flex flex-col">
    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-5 border-b border-neutral-800">
      <div class="flex items-center gap-3">
        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 text-white font-semibold text-sm" style="letter-spacing: -0.05em;">IA</div>
        <h1 class="text-lg font-semibold tracking-tight">Infinite Axis</h1>
      </div>
      <button id="theme-toggle" class="inline-flex h-9 w-9 items-center justify-center rounded-lg text-neutral-400 hover:bg-neutral-800 hover:text-neutral-100 transition-colors" aria-label="Cambiar tema">
        <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
        <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 hidden"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
      </button>
    </div>

    <!-- Upload Section -->
    <div class="p-6 border-b border-neutral-800">
      <label for="file-upload" class="block cursor-pointer">
        <div id="upload-area" class="upload-area flex flex-col items-center justify-center h-40 px-4 py-6 bg-neutral-800/50 border-2 border-dashed border-neutral-700 rounded-2xl hover:bg-neutral-800 hover:border-neutral-600 transition-all">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-10 w-10 text-neutral-500 mb-3"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>
          <p class="text-sm font-medium text-neutral-300 mb-1">Coloque la imagen aquí</p>
          <p class="text-xs text-neutral-500">- o -</p>
          <p class="text-xs text-neutral-500">Haga clic para cargar</p>
        </div>
        <input id="file-upload" type="file" accept="image/png,image/jpeg" class="hidden">
      </label>
      <button id="generate-btn" disabled class="mt-4 w-full inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-medium bg-violet-600 text-white hover:bg-violet-500 disabled:opacity-40 disabled:cursor-not-allowed transition-all">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
        Remover Fondo
      </button>
    </div>

    <!-- Tools Section -->
    <div class="flex-1 overflow-y-auto px-6 py-6">
      <div class="space-y-4">
        <!-- Info sobre Background Removal - Siempre visible arriba -->
        <div class="p-4 bg-violet-500/10 border border-violet-500/20 rounded-xl">
          <div class="flex items-start gap-3">
            <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-violet-500/20 text-violet-300 flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"></path><path d="M8.5 8.5v.01"></path><path d="M16 15.5v.01"></path><path d="M12 12v.01"></path><path d="M11 17v.01"></path><path d="M7 14v.01"></path></svg>
            </div>
            <div>
              <p class="text-xs font-medium text-violet-300 mb-1">Rembg Library</p>
              <p class="text-xs text-neutral-400">Elimina automáticamente el fondo</p>
            </div>
          </div>
        </div>

        <!-- Quality Settings - Se muestra cuando se carga imagen -->
        <div id="quality-section" class="hidden">
          <label class="block text-sm font-medium text-neutral-400 mb-3">Calidad</label>
          <div class="space-y-2">
            <div class="flex items-center justify-between px-4 py-2.5 bg-neutral-800/50 rounded-xl">
              <span class="text-sm">Resolución</span>
              <span id="resolution-value" class="text-sm font-medium text-violet-400">-</span>
            </div>
            <div class="flex items-center justify-between px-4 py-2.5 bg-neutral-800/50 rounded-xl">
              <span class="text-sm">Formato</span>
              <span id="format-value" class="text-sm font-medium text-violet-400">PNG</span>
            </div>
            <div class="flex items-center justify-between px-4 py-2.5 bg-neutral-800/50 rounded-xl">
              <span class="text-sm">Tamaño</span>
              <span id="size-value" class="text-sm font-medium text-violet-400">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 flex flex-col overflow-hidden">
    <!-- Top Bar -->
    <header class="border-b border-neutral-800 bg-neutral-900/30 backdrop-blur-sm">
      <div class="flex items-center justify-between px-6 py-4">
        <div>
          <h2 class="text-lg font-semibold tracking-tight">Preview</h2>
          <p class="text-sm text-neutral-500">Elimina el fondo de tus imágenes</p>
        </div>
        <div class="flex items-center gap-3">
          <button id="reset-btn" class="inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-medium text-neutral-400 hover:text-neutral-100 hover:bg-neutral-800 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>
            Reiniciar
          </button>
          <button id="guide-btn" class="inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm font-medium bg-neutral-800 text-neutral-100 hover:bg-neutral-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
            Guía de Uso
          </button>
        </div>
      </div>
    </header>

    <!-- Preview Grid -->
    <div class="flex-1 overflow-y-auto p-6">
      <div id="preview-empty" class="flex items-center justify-center h-full">
        <div class="text-center max-w-md">
          <div class="flex h-20 w-20 items-center justify-center rounded-2xl bg-neutral-800/50 text-neutral-600 mx-auto mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-10 w-10"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>
          </div>
          <h3 class="text-xl font-semibold tracking-tight mb-2">Sin Imagen Cargada</h3>
          <p class="text-sm text-neutral-500 mb-6">Sube una imagen para remover su fondo automáticamente</p>
          <div class="flex items-center justify-center gap-4 text-xs text-neutral-600">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M20 6 9 17l-5-5"></path></svg>
              <span>Alta Calidad</span>
            </div>
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M20 6 9 17l-5-5"></path></svg>
              <span>Procesamiento Rápido</span>
            </div>
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M20 6 9 17l-5-5"></path></svg>
              <span>Múltiples Ángulos</span>
            </div>
          </div>
        </div>
      </div>

      <div id="preview-grid" class="hidden grid grid-cols-2 gap-6 max-w-6xl mx-auto">
        <!-- Imagen de Entrada -->
        <div>
          <div class="card-bg bg-neutral-900/50 border border-neutral-800 rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-neutral-800">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-neutral-800">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-neutral-400"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>
                  </div>
                  <div>
                    <p class="text-sm font-medium">Imagen de Entrada</p>
                    <p class="text-xs text-neutral-500">Original cargada</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="aspect-square bg-neutral-800/50 flex items-center justify-center">
              <img id="original-preview" src="" alt="Original" class="max-w-full max-h-full object-contain hidden">
              <div id="original-placeholder" class="text-neutral-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-16 w-16"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Imagen de Salida -->
        <div id="output-image" class="card-bg bg-neutral-900/50 border border-neutral-800 rounded-2xl overflow-hidden">
          <div class="p-4 border-b border-neutral-800">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-violet-500/10">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 text-violet-400"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
                </div>
                <div>
                  <p class="text-sm font-medium">Imagen de Salida</p>
                  <p id="output-status" class="text-xs text-neutral-500">Esperando...</p>
                </div>
              </div>
              <button id="download-btn" class="hidden inline-flex h-8 w-8 items-center justify-center rounded-lg text-neutral-400 hover:bg-neutral-800 hover:text-neutral-100 transition-colors" aria-label="Descargar imagen">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
              </button>
            </div>
          </div>
          <div class="aspect-square bg-neutral-800/50 flex items-center justify-center relative">
            <div id="output-placeholder" class="text-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-16 w-16 text-neutral-600 mx-auto mb-3"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>
              <p class="text-sm text-neutral-500">Imagen generada aparecerá aquí</p>
            </div>
            <img id="output-preview" src="" alt="Output" class="hidden max-w-full max-h-full object-contain">
          </div>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <footer class="border-t border-neutral-800 bg-neutral-900/30 backdrop-blur-sm px-6 py-3">
      <div class="flex items-center justify-between text-xs">
        <div class="flex items-center gap-4 text-neutral-500">
          <div class="flex items-center gap-2">
            <div class="h-2 w-2 rounded-full bg-green-500"></div>
            <span>Modelo Listo</span>
          </div>
          <div class="h-4 w-px bg-neutral-800"></div>
          <span>Background Removal con rembg</span>
        </div>
        <div class="flex items-center gap-4 text-neutral-500">
          <span id="status-text">Listo para generar</span>
          <div class="h-4 w-px bg-neutral-800"></div>
          <a href="https://github.com/rodyuzuriaga/Infinite-Axis" target="_blank" rel="noopener" class="hover:text-neutral-300 transition-colors flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
            GitHub
          </a>
        </div>
      </div>
    </footer>
  </main>
</div>

<!-- Modal de Guía de Uso -->
<div id="guide-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
  <!-- Backdrop oscurecido y difuminado -->
  <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" id="guide-modal-backdrop"></div>
  
  <!-- Contenido del modal -->
  <div class="relative bg-neutral-900 border border-neutral-700 rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6 transform transition-all">
    <!-- Header del modal -->
    <div class="flex items-start justify-between mb-4">
      <div class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-violet-500/20 text-violet-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
        </div>
        <h3 class="text-lg font-semibold text-neutral-100">Guía de Uso</h3>
      </div>
      <button id="close-guide-modal" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-neutral-400 hover:bg-neutral-800 hover:text-neutral-100 transition-colors" title="Cerrar" aria-label="Cerrar guía de uso">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
      </button>
    </div>
    
    <!-- Contenido -->
    <div class="space-y-4">
      <p class="text-sm text-neutral-300 leading-relaxed">
        Sube una imagen y el fondo será removido automáticamente
      </p>
      
      <div class="bg-neutral-800/50 rounded-xl p-4 space-y-3">
        <div class="flex items-start gap-3">
          <div class="flex h-6 w-6 items-center justify-center rounded-full bg-violet-500/20 text-violet-400 text-xs font-semibold flex-shrink-0 mt-0.5">1</div>
          <div>
            <p class="text-sm font-medium text-neutral-200">Carga tu imagen</p>
            <p class="text-xs text-neutral-400 mt-1">Soporta formatos PNG y JPG</p>
          </div>
        </div>
        
        <div class="flex items-start gap-3">
          <div class="flex h-6 w-6 items-center justify-center rounded-full bg-violet-500/20 text-violet-400 text-xs font-semibold flex-shrink-0 mt-0.5">2</div>
          <div>
            <p class="text-sm font-medium text-neutral-200">Presiona "Remover Fondo"</p>
            <p class="text-xs text-neutral-400 mt-1">El proceso toma solo 2-5 segundos</p>
          </div>
        </div>
        
        <div class="flex items-start gap-3">
          <div class="flex h-6 w-6 items-center justify-center rounded-full bg-violet-500/20 text-violet-400 text-xs font-semibold flex-shrink-0 mt-0.5">3</div>
          <div>
            <p class="text-sm font-medium text-neutral-200">Descarga el resultado</p>
            <p class="text-xs text-neutral-400 mt-1">Obtendrás una imagen PNG con fondo transparente</p>
          </div>
        </div>
      </div>
      
      <button id="guide-modal-ok" class="w-full inline-flex items-center justify-center gap-2 rounded-xl px-4 py-2.5 text-sm font-medium bg-violet-600 text-white hover:bg-violet-500 transition-all">
        Entendido
      </button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
<script>
  lucide.createIcons();

  // Clean generated files on page load
  fetch('/clean', {
    method: 'POST'
  }).catch(error => {
    console.error('Error limpiando archivos al cargar:', error);
  });

  // Theme Toggle
  const themeToggle = document.getElementById('theme-toggle');
  const body = document.body;
  const iconMoon = document.getElementById('icon-moon');
  const iconSun = document.getElementById('icon-sun');

  themeToggle.addEventListener('click', () => {
    const isDark = body.getAttribute('data-theme') === 'dark';
    
    if (isDark) {
      body.setAttribute('data-theme', 'light');
      body.classList.remove('bg-neutral-950', 'text-neutral-100');
      body.classList.add('bg-white', 'text-neutral-900');
      iconMoon.classList.add('hidden');
      iconSun.classList.remove('hidden');
    } else {
      body.setAttribute('data-theme', 'dark');
      body.classList.remove('bg-white', 'text-neutral-900');
      body.classList.add('bg-neutral-950', 'text-neutral-100');
      iconSun.classList.add('hidden');
      iconMoon.classList.remove('hidden');
    }
    
    lucide.createIcons();
  });

  // Elements
  const fileUpload = document.getElementById('file-upload');
  const generateBtn = document.getElementById('generate-btn');
  const originalPreview = document.getElementById('original-preview');
  const originalPlaceholder = document.getElementById('original-placeholder');
  const outputPreview = document.getElementById('output-preview');
  const outputPlaceholder = document.getElementById('output-placeholder');
  const outputStatus = document.getElementById('output-status');
  const downloadBtn = document.getElementById('download-btn');
  const previewEmpty = document.getElementById('preview-empty');
  const previewGrid = document.getElementById('preview-grid');
  const statusText = document.getElementById('status-text');
  
  // Quality section elements
  const qualitySection = document.getElementById('quality-section');
  const resolutionValue = document.getElementById('resolution-value');
  const formatValue = document.getElementById('format-value');
  const sizeValue = document.getElementById('size-value');

  let uploadedFile = null;
  let currentImageData = null;

  // File upload - Auto preview
  fileUpload.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      if (!file.type.startsWith('image/') || (!file.type.includes('png') && !file.type.includes('jpeg') && !file.type.includes('jpg'))) {
        alert('Por favor selecciona una imagen PNG o JPG.');
        return;
      }

      uploadedFile = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        // Show preview immediately
        previewEmpty.classList.add('hidden');
        previewGrid.classList.remove('hidden');
        
        const img = new Image();
        img.onload = () => {
          // Update original preview
          originalPreview.src = e.target.result;
          originalPreview.classList.remove('hidden');
          originalPlaceholder.classList.add('hidden');
          
          // Update quality section
          const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
          resolutionValue.textContent = `${img.width}x${img.height}`;
          formatValue.textContent = file.type.includes('png') ? 'PNG' : 'JPEG';
          sizeValue.textContent = `${fileSizeMB} MB`;
          qualitySection.classList.remove('hidden');
          
          generateBtn.disabled = false;
          statusText.textContent = 'Imagen cargada - Presiona Remover Fondo';
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  // Generate button
  generateBtn.addEventListener('click', async () => {
    if (!uploadedFile) {
      alert('Por favor carga una imagen primero');
      return;
    }

    // Show processing state
    outputStatus.textContent = 'Procesando...';
    outputPreview.classList.add('hidden');
    outputPlaceholder.innerHTML = '<div class="h-12 w-12 rounded-full border-2 border-neutral-700 border-t-violet-500 animate-spin mx-auto mb-3"></div><p class="text-sm text-neutral-500">Removiendo fondo...</p>';
    statusText.textContent = 'Procesando imagen...';

    try {
      // Send to backend
      const formData = new FormData();
      formData.append('image', uploadedFile);
      formData.append('prompt', 'background removal');

      const response = await fetch('/generate', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        const result = await response.json();
        console.log('Resultado del servidor:', result);
        
        // Show generated image (use base64 for preview, keep URL for download)
        currentImageData = result.image_data;
        console.log('Image data length:', result.image_data ? result.image_data.length : 0);
        outputPreview.src = currentImageData;
        outputPreview.dataset.downloadUrl = result.image_url; // Store URL for download
        outputPreview.classList.remove('hidden');
        outputPlaceholder.classList.add('hidden');
        outputStatus.textContent = 'Completado ✓';
        downloadBtn.classList.remove('hidden');
        statusText.textContent = 'Fondo removido exitosamente';
        
        // Update quality info with result
        if (result.parameters) {
          resolutionValue.textContent = `${result.parameters.width}x${result.parameters.height}`;
        }
      } else {
        throw new Error('Error en el procesamiento');
      }
    } catch (error) {
      console.error('Error:', error);
      outputStatus.textContent = 'Error ✗';
      outputPlaceholder.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-16 w-16 text-red-400 mx-auto mb-3"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></svg><p class="text-sm text-neutral-500">Error al procesar</p>';
      statusText.textContent = 'Error en el procesamiento';
    }
  });

  // Download button
  downloadBtn.addEventListener('click', () => {
    // Use the stored download URL from the file
    const downloadUrl = outputPreview.dataset.downloadUrl;
    if (downloadUrl) {
      const link = document.createElement('a');
      link.href = downloadUrl;
      link.download = `background-removed-${Date.now()}.png`;
      link.click();
    }
  });

  // Reset button - Clean generated files and reload page
  const resetBtn = document.getElementById('reset-btn');
  resetBtn.addEventListener('click', async () => {
    try {
      // Call backend to clean generated files
      await fetch('/clean', {
        method: 'POST'
      });
    } catch (error) {
      console.error('Error limpiando archivos:', error);
    }
    // Reload page regardless of clean result
    location.reload();
  });

  // Guide modal functionality
  const guideBtn = document.getElementById('guide-btn');
  const guideModal = document.getElementById('guide-modal');
  const guideModalBackdrop = document.getElementById('guide-modal-backdrop');
  const closeGuideModal = document.getElementById('close-guide-modal');
  const guideModalOk = document.getElementById('guide-modal-ok');

  // Open modal
  guideBtn.addEventListener('click', () => {
    guideModal.classList.remove('hidden');
  });

  // Close modal - backdrop click
  guideModalBackdrop.addEventListener('click', () => {
    guideModal.classList.add('hidden');
  });

  // Close modal - X button
  closeGuideModal.addEventListener('click', () => {
    guideModal.classList.add('hidden');
  });

  // Close modal - OK button
  guideModalOk.addEventListener('click', () => {
    guideModal.classList.add('hidden');
  });
</script>

</body>
</html>